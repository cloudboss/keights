[Unit]
Description=kubelet
Requires=keights-configure.target docker.socket
After=keights-configure.target docker.socket

[Service]
Type=simple
# Environment=KEIGHTS_DOMAIN=
# Environment=KEIGHTS_NODE_LABELS=
# Environment=KEIGHTS_NODE_REGISTER=
Environment=KEIGHTS_KUBELET_EXTRA_OPTS=
ExecStart=/usr/local/bin/kubelet \
            --node-labels=${KEIGHTS_NODE_LABELS} \
            ${KEIGHTS_NODE_REGISTER} \
            --bootstrap-kubeconfig=/run/kubernetes/bootstrap.kubeconfig \
            --kubeconfig=/var/lib/kubelet/kubeconfig \
            --tls-cert-file=/var/lib/kubelet/pki/kubelet-client.crt \
            --tls-private-key-file=/var/lib/kubelet/pki/kubelet-client.key \
            --client-ca-file=/run/kubernetes/pki/apiserver-kubelet-client.crt \
            --cluster-domain=${KEIGHTS_DOMAIN} \
            --image-pull-progress-deadline=2m \
            --pod-manifest-path=/etc/kubernetes/manifests \
            --runtime-request-timeout=15m \
            --network-plugin=cni \
            --cni-bin-dir=/usr/lib/cni \
            --v=2 ${KEIGHTS_KUBELET_EXTRA_OPTS}
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
